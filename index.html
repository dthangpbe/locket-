<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Chia s·∫ª ·∫£nh theo th·ªùi gian th·ª±c v·ªõi b·∫°n b√® - Locket Style Photo Sharing">
    <title>G9Cam - Chia s·∫ª kho·∫£nh kh·∫Øc</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="G9Cam">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Auth Modal -->
    <div id="authModal" class="modal active">
        <div class="modal-content auth-modal">
            <h2>‚ú® Ch√†o m·ª´ng ƒë·∫øn G9Cam</h2>
            <p>Chia s·∫ª kho·∫£nh kh·∫Øc c·ªßa b·∫°n v·ªõi b·∫°n b√®</p>

            <!-- Tab Switcher -->
            <div class="auth-tabs">
                <button class="auth-tab-btn active" data-tab="register">ƒêƒÉng k√Ω</button>
                <button class="auth-tab-btn" data-tab="login">ƒêƒÉng nh·∫≠p</button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form active">
                <input type="text" id="regUsername" placeholder="T√™n ng∆∞·ªùi d√πng (4-20 k√Ω t·ª±)" maxlength="20" required>
                <input type="password" id="regPassword" placeholder="M·∫≠t kh·∫©u (t·ªëi thi·ªÉu 6 k√Ω t·ª±)" required>
                <input type="password" id="regConfirmPassword" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" required>
                <input type="text" id="regDisplayName" placeholder="T√™n hi·ªÉn th·ªã (t√πy ch·ªçn)" maxlength="30">
                <div id="regError" class="error-message"></div>
                <button id="registerBtn" class="primary-btn">T·∫°o t√†i kho·∫£n</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <input type="text" id="loginUsername" placeholder="ID t√†i kho·∫£n ho·∫∑c t√™n ng∆∞·ªùi d√πng" required>
                <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u" required>
                <div id="loginError" class="error-message"></div>
                <button id="loginBtn" class="primary-btn">ƒêƒÉng nh·∫≠p</button>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title"><img src="logo.png" alt="G9Cam"
                        style="height: 48px; width: auto; vertical-align: middle;"></h1>

                <div class="header-right">
                    <!-- Profile Avatar -->
                    <button id="profileBtn" class="profile-avatar-btn" title="Profile">
                        <div id="headerAvatar" class="header-avatar"></div>
                    </button>

                    <!-- Hamburger Menu -->
                    <button class="hamburger-menu" id="hamburgerBtn" aria-label="Menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>

            <!-- Dropdown Menu -->
            <div class="dropdown-menu" id="dropdownMenu">
                <button class="menu-item" id="menuAlbumsBtn">
                    <span class="menu-icon">üìÅ</span>
                    <span>Albums</span>
                </button>
                <button class="menu-item" id="menuFriendsBtn">
                    <span class="menu-icon">üë•</span>
                    <span>B·∫°n b√®</span>
                    <span class="badge" id="menuFriendCount">0</span>
                </button>
                <button class="menu-item" id="menuNotificationsBtn">
                    <span class="menu-icon">üîî</span>
                    <span>Th√¥ng b√°o</span>
                    <span class="notif-badge" id="menuNotifBadge" style="display: none;">0</span>
                </button>
                <button class="menu-item" id="menuThemeBtn">
                    <span class="menu-icon" id="menuThemeIcon">üåô</span>
                    <span>Ch·∫ø ƒë·ªô s√°ng/t·ªëi</span>
                </button>
                <div class="menu-divider"></div>
                <button class="menu-item" id="menuLogoutBtn">
                    <span class="menu-icon">üö™</span>
                    <span>ƒêƒÉng xu·∫•t</span>
                </button>
            </div>
        </header>

        <!-- Camera Section -->
        <section class="camera-section">
            <div class="camera-container">
                <div class="camera-box">
                    <video id="cameraPreview" autoplay playsinline></video>
                    <canvas id="photoCanvas" style="display: none;"></canvas>
                    <div id="capturedPhoto" class="captured-photo" style="display: none;">
                        <img id="capturedImg" src="" alt="Captured">
                    </div>
                    <div class="camera-overlay">
                        <div class="camera-controls">
                            <button id="flipCameraBtn" class="flip-camera-btn" title="Chuy·ªÉn camera">
                                üîÑ
                            </button>
                            <button id="captureBtn" class="capture-btn">
                                <span class="capture-circle"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Caption Input (Hidden Initially) -->
                <div id="captionSection" class="caption-section" style="display: none;">
                    <textarea id="captionInput" placeholder="Vi·∫øt caption cho ·∫£nh...‚úçÔ∏è" maxlength="150"></textarea>
                    <select id="albumSelect"
                        style="width: 100%; padding: 0.75rem; margin: 0.75rem 0; border-radius: 8px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 1rem;">
                        <option value="">üìÅ Kh√¥ng th√™m v√†o album</option>
                    </select>
                    <div class="caption-actions">
                        <button id="cancelBtn" class="secondary-btn">H·ªßy</button>
                        <button id="postBtn" class="primary-btn">ƒêƒÉng ·∫£nh</button>
                    </div>
                </div>
            </div>

            <div class="scroll-indicator">
                <p>L∆∞·ªõt xu·ªëng ƒë·ªÉ xem ·∫£nh c·ªßa b·∫°n b√® üëá</p>
                <div class="scroll-arrow">‚Üì</div>
            </div>
        </section>

        <!-- Photo Feed -->
        <section class="feed-section">
            <h2>ÔøΩ B·∫£ng tin</h2>

            <div class="feed-controls">
                <select id="friendFilter" class="friend-filter">
                    <option value="all">T·∫•t c·∫£ b·∫°n b√®</option>
                </select>

                <button id="viewToggle" class="view-toggle-btn" title="Chuy·ªÉn ch·∫ø ƒë·ªô xem">
                    <span class="grid-icon">‚äû</span>
                    <span class="list-icon" style="display: none;">‚ò∞</span>
                </button>
            </div>

            <div id="photoFeed" class="photo-feed">
                <!-- Photos will be dynamically inserted here -->
            </div>
        </section>
    </div>

    <!-- Friends Modal -->
    <div id="friendsModal" class="modal">
        <div class="modal-content friends-modal">
            <div class="modal-header">
                <h2>üë• B·∫°n b√®</h2>
                <button class="close-btn" id="closeFriendsModal">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Friend Search -->
                <div class="friend-search-section">
                    <div class="search-input-wrapper">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="friendSearchInput" placeholder="T√¨m ki·∫øm b·∫°n b·∫±ng ID (vd: @user-12345)"
                            maxlength="30">
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>

                <div class="friends-tabs">
                    <button class="tab-btn active" data-tab="myFriends">B·∫°n b√® c·ªßa t√¥i</button>
                    <button class="tab-btn" data-tab="suggested">L·ªùi m·ªùi k·∫øt b·∫°n</button>
                </div>
                <div class="tab-content active" id="myFriendsTab">
                    <div id="friendsList" class="friends-list">
                        <!-- Friends will be listed here -->
                    </div>
                </div>
                <div class="tab-content" id="suggestedTab">
                    <div id="suggestedList" class="friends-list">
                        <!-- Suggested friends will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reactions Modal -->
    <div id="reactionsModal" class="modal">
        <div class="modal-content reactions-modal">
            <h3>Th·∫£ c·∫£m x√∫c</h3>
            <div class="reactions-grid">
                <button class="reaction-btn" data-reaction="‚ù§Ô∏è">‚ù§Ô∏è</button>
                <button class="reaction-btn" data-reaction="üòç">üòç</button>
                <button class="reaction-btn" data-reaction="üòÇ">üòÇ</button>
                <button class="reaction-btn" data-reaction="üòÆ">üòÆ</button>
                <button class="reaction-btn" data-reaction="üò¢">üò¢</button>
                <button class="reaction-btn" data-reaction="üëè">üëè</button>
                <button class="reaction-btn" data-reaction="üî•">üî•</button>
                <button class="reaction-btn" data-reaction="‚ú®">‚ú®</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal">
            <button class="close-btn" id="closeProfileModal">‚úï</button>

            <!-- Profile View Mode -->
            <div id="profileView" class="profile-view">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profileAvatarDisplay">
                        <img id="profileAvatarImg" src="" alt="Avatar" style="display: none;">
                        <span id="profileAvatarEmoji">üë§</span>
                    </div>
                    <h2 id="profileDisplayName">User Name</h2>
                    <p class="profile-account-id" id="profileAccountId">@username-12345</p>
                </div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="profileFriendCount">0</span>
                        <span class="stat-label">B·∫°n b√®</span>
                    </div>
                </div>
                <div class="profile-bio">
                    <h4>Ti·ªÉu s·ª≠</h4>
                    <p id="profileBioText">Ch∆∞a c√≥ ti·ªÉu s·ª≠</p>
                </div>
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button id="editProfileBtn" class="primary-btn" style="flex: 1;">Ch·ªânh s·ª≠a Profile</button>
                    <!-- Logout button removed - now in hamburger menu -->
                </div>
            </div>

            <!-- Profile Edit Mode -->
            <div id="profileEdit" class="profile-edit" style="display: none;">
                <h3>Ch·ªânh s·ª≠a Profile</h3>

                <div class="form-group">
                    <label>Avatar</label>
                    <div class="avatar-upload">
                        <div class="avatar-preview" id="avatarPreview">
                            <img id="avatarPreviewImg" src="" alt="Avatar" style="display: none;">
                            <span id="avatarPreviewEmoji">üë§</span>
                        </div>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                        <button id="uploadAvatarBtn" class="secondary-btn">Ch·ªçn ·∫£nh</button>
                        <button id="removeAvatarBtn" class="secondary-btn" style="display: none;">X√≥a ·∫£nh</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editDisplayName">T√™n hi·ªÉn th·ªã</label>
                    <input type="text" id="editDisplayName" maxlength="30" placeholder="T√™n hi·ªÉn th·ªã">
                </div>

                <div class="form-group">
                    <label for="editBio">Ti·ªÉu s·ª≠</label>
                    <textarea id="editBio" maxlength="150" placeholder="Vi·∫øt v√†i d√≤ng v·ªÅ b·∫°n..." rows="4"></textarea>
                    <span class="char-count" id="bioCharCount">0/150</span>
                </div>

                <div class="profile-actions">
                    <button id="cancelEditBtn" class="secondary-btn">H·ªßy</button>
                    <button id="saveProfileBtn" class="primary-btn">L∆∞u thay ƒë·ªïi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content notifications-modal">
            <div class="modal-header">
                <h2>Th√¥ng b√°o</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="secondary-btn" onclick="clearReadNotifications()">X√≥a ƒë√£ ƒë·ªçc</button>
                    <button class="close-btn" id="closeNotificationsModal">√ó</button>
                </div>
            </div>
            <div id="notificationsList" class="notifications-list">
                <!-- Notifications rendered here -->
            </div>
        </div>
    </div>

    <!-- Albums Modal -->
    <div id="albumsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÅ Albums c·ªßa t√¥i</h2>
                <button class="close-modal"
                    onclick="closeModal(document.getElementById('albumsModal'))">&times;</button>
            </div>
            <button id="createAlbumBtn" class="primary-btn" style="margin: 1rem;">+ T·∫°o Album M·ªõi</button>
            <div id="albumsList" class="albums-grid"></div>
        </div>
    </div>

    <!-- Create Album Modal -->
    <div id="createAlbumModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>T·∫°o Album M·ªõi</h2>
                <button class="close-modal"
                    onclick="closeModal(document.getElementById('createAlbumModal'))">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <input type="text" id="albumName" placeholder="T√™n album..." maxlength="50"
                    style="width: 100%; margin-bottom: 1rem;">
                <textarea id="albumDescription" placeholder="M√¥ t·∫£ (t√πy ch·ªçn)..." maxlength="200"
                    style="width: 100%; min-height: 80px; margin-bottom: 1rem;"></textarea>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="saveAlbumBtn" class="primary-btn">T·∫°o Album</button>
                    <button onclick="closeModal(document.getElementById('createAlbumModal'))"
                        class="secondary-btn">H·ªßy</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Album Detail Modal -->
    <div id="albumDetailModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <div>
                    <h2 id="albumDetailTitle">Album</h2>
                    <p id="albumDetailDesc" style="color: var(--text-secondary); margin: 0.5rem 0 0 0;"></p>
                </div>
                <button class="close-modal"
                    onclick="closeModal(document.getElementById('albumDetailModal'))">&times;</button>
            </div>
            <div id="albumPhotosGrid" class="albums-photos-grid"></div>
        </div>
    </div>

    <!-- Image Zoom Modal -->
    <div id="imageZoomModal" class="modal">
        <div class="modal-overlay" onclick="closeImageZoom()"></div>
        <div class="image-zoom-container">
            <button class="image-zoom-close" onclick="closeImageZoom()">‚úï</button>
            <img id="zoomedImage" src="" alt="Zoomed image">
        </div>
    </div>

    <!-- Reactions Modal -->
    <div id="reactionsModal" class="modal">
        <div class="modal-content">
            <h3>Th·∫£ c·∫£m x√∫c üòä</h3>
            <div class="reaction-emojis">
                <button onclick="addReaction('‚ù§Ô∏è')" class="emoji-btn">‚ù§Ô∏è</button>
                <button onclick="addReaction('üòÇ')" class="emoji-btn">üòÇ</button>
                <button onclick="addReaction('üòÆ')" class="emoji-btn">üòÆ</button>
                <button onclick="addReaction('üò¢')" class="emoji-btn">üò¢</button>
                <button onclick="addReaction('üëç')" class="emoji-btn">üëç</button>
                <button onclick="addReaction('üî•')" class="emoji-btn">üî•</button>
                <button onclick="addReaction('üéâ')" class="emoji-btn">üéâ</button>
                <button onclick="addReaction('üíØ')" class="emoji-btn">üíØ</button>
            </div>
            <button class="close-modal" onclick="closeModal(document.getElementById('reactionsModal'))">√ó</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>

    <!-- Application Logic -->
    <script src="app.js"></script>
</body>

</html>